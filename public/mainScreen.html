<!--
==== =================================================================

==    MAINSCREEN.HTML    ==
==    Dit bestand word ingeladen in de container in de index.html als het hoofdscherm.
==    In MAINSCREEN voeren we de broadcasts uit en andere verschillende functies,
==    daarom is dit te vergelijken met de daadwerkelijke 'homepage'.

==== =================================================================
==    Door Thijs Boerma, th.boerma@gmail.com | 2017                 ==
==== =================================================================
-->

<!-- bovenste helft -->
<div class="middle row">

  <!-- linkerbar -->
  <div class="col-xs-12 col-sm-12 col-md-4 col-lg-3 pZero">
    <div class="left-bar col-xs-12">

      <div id="notificationTitleSmall" class="hidden-xs headerblock">
        <h2>Waiting for broadcasts ...</h2>
      </div>

      <div class="clockblock block block-medium col-xs-12">
        <h1 id="clock" class="text-center">[ 00:00:00 ECT ]</h1>
      </div>

      <div class="block block-medium hidden-xs hidden-sm col-md-12">
        <p>Last notification:<br/><span id="lastBroadcastTitle">N/A</span>&nbsp;&nbsp;|&nbsp;&nbsp;<span id="lastBroadcastTime">00:00</span></p>
      </div>
    </div>

    <div class="left-bar no-bg hidden-xs col-sm-12 col-md-12">
      <div class="headerblock">
        <h2>Portal Status</h2>
      </div>

      <div class="portalstatus">
        <div class="col-xs-6 col-sm-5 col-md-3">
          <span class="portalstatus-icon"><i class="glyphicon glyphicon-check"></i></span>
        </div>
        <div class="col-xs-6 col-sm-7 col-md-9">
          <h4 class="portalstatus-title">Operational.</h4>
          <p class="portalstatus-text">Nothing to report.</p>
        </div>
      </div>
      <!-- <ul id="colony-feed"></ul> -->

    </div>

  </div>

  <!-- centraal blok -->
  <!-- <div class="middle-bar col-xs-12 col-sm-10 col-md-8 col-lg-9"> -->
  <div class="middle-bar col-xs-12 col-sm-12 col-md-8 col-lg-9">
    <div class="block no-bg">
      <div id="notificationContainer">
        <!-- placehold spincircle: loading 800ms lang ivm jquery. -->
        <div class="portalCircleContainer" style="padding-top:10rem;">
          <div class="portalCircle">&nbsp;</div>
        </div>

      </div>
    </div>
  </div>

</div>

<!-- onderste helft -->
<div class="footer row">

  <div class="item col-xs-12 col-sm-12 col-md-4 col-lg-2">
    <div id="firstFooterBlock" class="block">
      <div class="content">

        <h1 id="dd">
          <span class="glitch" data-text="00">00</span>
        </h1>

        <h1 id="dow">
          <span class="glitch" data-text="J2405130">J2405130</span>
        </h1>

        <h3 id="customdate">FEBRUARY 240NT</h3>

      </div>
    </div>
  </div>

  <div class="item col-xs-12 col-sm-12 col-md-5 col-lg-3">
    <div class="block">
      <div class="content">
        <h1>ALERT LEVEL</h1>
        <h3 id="securityAlertLevel">
          <span class="glitch" data-text="$p infomorph#02 ..">$p infomorph#02 ..</span>
        </h3>
      </div>
    </div>
  </div>

  <div class="item col-xs-12 col-sm-12 col-md-3 col-lg-2">
    <div class="block">
      <div class="headerblock margin-zero">
        <h2 class="regularfont">Open Connections</h2>
      </div>
      <h2 class="text-center"><i class="glyphicon glyphicon-user"></i></h2>
      <h2 class="text-center alt-color" id="countClientsCounter">
        <span class="glitch" data-text="0">0</span>
      </h2>
    </div>
  </div>

  <div class="item col-xs-12 col-sm-12 col-md-12 col-lg-5">
    <div class="block">
      <div class="headerblock margin-zero">
        <h2 class="regularfont">Device &amp; Connection info</h2>
      </div>
      <div class="content">

        <div class="col-xs-12 col-sm-12 col-md-8">
          <h2>DEVICE:</h2>
          <p>&nbsp;WORKGROUPS-> &nbsp;<span id="clientName">none</span></p>
          <p id="socket-id"><span class="glitch" data-text="connecting ..">connecting ..</span></p>
        </div>

        <div class="col-xs-12 col-sm-12 col-md-4">
          <h2>STATUS:</h2>
          <p id="connStatus" style="cursor: default;" class="btn btn-lg btn-outline-success"><i class="glyphicon glyphicon-link"></i>&nbsp;CONNECTED</p>
        </div>

      </div>
    </div>
  </div>

</div>

<script>


$(document).ready(function(){
  var bcinit = 0;
  var clientdevice = "";
  var printresult;

  // functie: maak blokken footer even groot.
  updateFooter();

  /* na een halve seconde, stuur de default broadcast naar =alleen= deze client. */
  setTimeout(function(){
    socket.emit('requestDynamicData');
  },800);

  /* hier defineren we de realtime update: als de =socket= een broadcast ontvangt, dan voert de client deze uit.*/
  socket.on('broadcastReceive', function(location){
    console.log('# BROADCAST RECEIVED !');
    /* uitvoeren op client. */
    broadCast(location);
    console.log('# ... OK');
  });

  var defaultSoundFile = "/sounds/Menu_Select_00.wav";

  if ($(window).width() > 960) {
    $('.audiocontrol').html('<audio id="default-audio" controls="controls" class="hidden">'
    + '<source src="'+ defaultSoundFile +'" type="audio/mpeg">'
    +'</audio>');
  }

  // vraagt dynamische data op, zoals security level en actieve gebruikers.

  // en update hem hier.
  socket.on('updateDynamicData', function(dynamicData){
    $('#securityAlertLevel').html(dynamicData['alertLevel']);
    $('#countClientsCounter').html(dynamicData['countClients']);

    /*resume! client only.*/
    if(bcinit == 0) {
      broadCast(window[dynamicData['lastBC']]);
      bcinit = 1;
    }

    /* client device name! */
    $('#socket-id').html('&nbsp;CONN->&nbsp;<span class="holoContrast">'+socket.id+'</span>');

  });

  /* reconnect/disconnect */
  socket.on('connect', function(){
    $('#connStatus').addClass('btn-outline-success').removeClass('btn-outline-danger blinkContent').html('<i class="glyphicon glyphicon-link"></i>&nbsp;CONNECTED');

    $('#socket-id').html('&nbsp;CONN->&nbsp;<span class="holoContrast">'+socket.id+'</span>');
    $('#countClientsCounter').show();
    $('#notificationTitleSmall h2').html('Waiting for broadcasts ...');

    $('.disconnectedPopup').empty();
    $('.disconnectedPopup').remove();

    $('#localIP').removeClass('text-muted blinkContent');
    $('.portalstatus').removeClass('blinkContent');

    setTimeout(function(){
      socket.emit('requestDynamicData');
    },800);
  });

  socket.on('disconnect', function(){
    $('#connStatus').addClass('btn-outline-danger blinkContent').removeClass('btn-outline-success').html('<i class="glyphicon glyphicon-alert"></i>&nbsp;OFFLINE');

    $('#socket-id').html('&nbsp;<span class="holoContrast">No active infomorph.</span>');
    $('#countClientsCounter').hide();
    $('#notificationTitleSmall h2').html('Attempting to reconnect...');

    $('#notificationContainer').append(
      '<div class="col-xs-12 col-sm-8 col-md-6 text-center disconnectedPopup">'
      + '<h2 class="text-bold">'
      +   '<i class="glyphicon glyphicon-alert holoContrast" style="font-size:24px;"></i> '
      +     'COMMUNICATIONS <span class="holoContrast">OFFLINE</span>'
      +   ' <i class="glyphicon glyphicon-alert holoContrast" style="font-size:24px;"></i>'
      + '</h2>'
      +'</div>');

    $('#localIP').addClass('text-muted blinkContent');
    $('.portalstatus').addClass('blinkContent');
  });

});
</script>
