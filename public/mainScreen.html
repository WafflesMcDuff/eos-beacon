<!--
==== =================================================================

==    MAINSCREEN.HTML    ==
==    Dit bestand word ingeladen in de container in de index.html als het hoofdscherm.
==    In MAINSCREEN voeren we de broadcasts uit en andere verschillende functies,
==    daarom is dit te vergelijken met de daadwerkelijke 'homepage'.

==== =================================================================
==    Door Thijs Boerma, th.boerma@gmail.com | 2017                 ==
==== =================================================================
-->

<!-- bovenste helft ----------------------------------------------------------->
<div class="middle row">

  <!-- linkerbar -->
  <div class="col-xs-12 col-sm-12 col-md-4 col-lg-3 pZero">
    <div class="left-bar col-xs-12">

      <div id="notificationTitleSmall" class="hidden-xs headerblock">
        <h2>Waiting for broadcasts ...</h2>
      </div>

      <div class="clockblock block block-medium col-xs-12">
        <h1 id="clock" class="text-center">[ 00:00:00 ECT ]</h1>
      </div>

      <div class="block block-medium hidden-xs  col-sm-12">
        <p>Last notification:</p>
        <p><span id="lastBroadcastTitle">N/A</span>&nbsp;&nbsp;|&nbsp;&nbsp;<span id="lastBroadcastTime">00:00</span></p>
      </div>
    </div>

    <div class="left-bar no-bg hidden-xs hidden-sm col-md-12">
      <div class="headerblock">
        <h2>Colony Messages</h2>
      </div>

      <ul id="colony-feed"></ul>

    </div>

</div>

  <!-- centraal blok -->
  <!-- <div class="middle-bar col-xs-12 col-sm-10 col-md-8 col-lg-9"> -->
  <div class="middle-bar col-xs-12 col-sm-12 col-md-8 col-lg-9">
    <div class="block no-bg">
      <div id="notificationContainer"></div>
    </div>
  </div>

</div>

<!-- onderste helft ----------------------------------------------------------->
<div class="footer row">

  <div class="item col-xs-12 col-sm-12 col-md-4 col-lg-2">
    <div id="firstFooterBlock" class="block">
      <div class="content">
        <h1 id="dd">01</h1>
        <h1 id="dow">FRIDAY</h1>
        <h3 id="customdate">FEBRUARY 240NT</h3>
      </div>
    </div>
  </div>

  <div class="item col-xs-12 col-sm-12 col-md-4 col-lg-3">
    <div class="block">
      <div class="content">
        <h1>ALERT LEVEL</h1>
        <h3 id="securityAlertLevel">-</h3>
      </div>
    </div>
  </div>

  <div class="item col-xs-12 col-sm-12 col-md-4 col-lg-2">
    <div class="block">
      <div class="headerblock margin-zero">
        <h2 class="regularfont">Active Clients</h2>
      </div>
      <h2 class="text-center"><i class="glyphicon glyphicon-user"></i></h2>
      <h2 class="text-center alt-color" id="countClientsCounter">-</h2>
    </div>
  </div>

  <div class="item hidden-xs col-sm-12 col-md-12 col-lg-5">
    <div class="block">

    </div>
  </div>

</div>

<div id="dynamicSoundSetting" class="hidden"></div>
<script>


$(document).ready(function(){
  var activeMessages = 0;
  var printresult;

  // functie: maak blokken footer even groot.
  updateFooter();

  // na een halve seconde, stuur de default broadcast naar =alleen= deze client.
  // de defaultBroadcast staat hier dubbel gedefineerd :: ik ben er nog niet achter waarom deze niet word geÃ«rf uit functions.js .
  var defaultBroadcast  = new broadcastObj("Beacon Initialised","standby","1","0","0");

  setTimeout(function(){

    broadCast(defaultBroadcast);
    socket.emit('requestDynamicData');

  },500);

  // hier defineren we de realtime update: als de =socket= een broadcast ontvangt, dan voert de client deze uit.
  socket.on('broadcastReceive', function(location){
    // console.log(activeBroadcast);
    console.log('# BROADCAST RECEIVED !');
    console.log('# ...');
    // uitvoeren op client.
    broadCast(location);
    console.log('# ... OK');
  });


  socket.on('globalChatMessage', function(message) {
    activeMessages = (activeMessages+1);

    var currentTimeString = getCurrentTime();
    var printresult = '<li class="feed-item" data-listnumber="'+activeMessages+'">';
    printresult = (printresult + '<p class="feed-top"><span class="feed-timestamp"><i class="glyphicon glyphicon-time"></i>&nbsp;'+currentTimeString+'</span>&nbsp;<span class="feed-user"><i class="glyphicon glyphicon-user"></i>&nbsp;'+message[0]+'</span></p>');
    printresult = (printresult + '<p class="feed-message">'+message[1]+'</p>');
    printresult = (printresult + '</li>');

    $('#colony-feed').prepend(printresult);

    if(activeMessages > 7) {
      var removeThis = (activeMessages-7);
      $("li[data-listnumber='" + removeThis +"']").remove();
    }

  });


  // vraagt dynamische data op, zoals security level en actieve gebruikers.

  // en update hem hier.
  socket.on('updateDynamicData', function(dynamicData){
    $('#securityAlertLevel').html(dynamicData['alertLevel']);
    $('#countClientsCounter').html(dynamicData['countClients']);
    $('#dynamicSoundSetting').html(dynamicData['soundsEnabled']);
    // meer toevoegen.
    // broadcast Last Active, als een soort resume ??

  });

});
</script>
